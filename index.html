<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game Sweat — Live Bet Tracker</title>
<style>
  :root{--fg:#111;--bg:#fff;--muted:#666;--ok:#0a8;--card:#f7f7f7;}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:Inter, system-ui, Arial;}
  .wrap{max-width:960px;margin:24px auto;padding:16px}
  h1{margin:0 0 4px 0;font-size:28px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:16px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .card{background:var(--card);border-radius:12px;padding:14px;margin:10px 0;box-shadow:0 1px 2px rgba(0,0,0,.06)}
  .game{border-left:4px solid #222;padding-left:10px;margin:16px 0 8px}
  .slip h3{margin:0 0 6px 0}
  .bet{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;margin:8px 0}
  .pill{background:#eef;border-radius:999px;padding:2px 8px;font-size:12px}
  .bar{height:10px;background:#ddd;border-radius:6px;overflow:hidden;flex:1}
  .fill{height:100%;background:linear-gradient(90deg,#33c,#2aa);width:0%}
  .pct{width:48px;text-align:right;font-variant-numeric:tabular-nums}
  .btn{padding:8px 10px;border:1px solid #ccc;border-radius:8px;background:#fff;cursor:pointer;font-size:12px}
  .btn:hover{background:#f3f3f3}
  .now{width:76px;text-align:right}
  .tiny{font-size:12px;color:var(--muted)}
  .chk{accent-color:#0a8;width:18px;height:18px}
  input[type="text"]{padding:8px;border:1px solid #ccc;border-radius:8px}
  .ok{outline:2px solid var(--ok);background:#eafff5}
  .danger{outline:2px solid #d33;background:#ffecec}
  code{background:#f0f0f0;padding:2px 6px;border-radius:6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Game Sweat — Live Bet Tracker</h1>
  <div class="sub">Share this page with friends. Manually update the numbers now; later, turn on auto-refresh with a free API key.</div>

  <div class="card">
    <h3>1) Game Setup (today only)</h3>
    <div class="tiny">If you add the API later, these IDs let the page pull the correct games.</div>
    <div class="row" style="margin-top:8px">
      <label>KC @ BAL game ID <input id="kcBal" type="text" placeholder="e.g., 20250928-KC-BAL" /></label>
      <label>GB @ DAL game ID <input id="gbDal" type="text" placeholder="e.g., 20250928-GB-DAL" /></label>
      <button class="btn" id="saveIds">Save</button>
      <button class="btn" id="loadWeek">Load Week 4 list (needs API)</button>
    </div>
    <div id="gamesOut" class="tiny" style="margin-top:6px"></div>
  </div>

  <h2 class="game">Green Bay Packers @ Dallas Cowboys</h2>
  <div class="card slip" id="slipA">
    <h3>Bet Slip A</h3>
    <div class="tiny">Tip: Use <a target="_blank" href="https://www.espn.com/nfl/team/_/name/gb/green-bay-packers">ESPN box scores</a> to grab live numbers quickly.</div>

    <div class="bet">
      <div class="row"><span class="pill">ATTD</span><strong>Josh Jacobs</strong> — Anytime TD</div>
      <label class="row tiny"><input type="checkbox" class="chk" data-type="td"> TD Scored</label>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Pass Yds</span><strong>Dak Prescott</strong> — 175+</div>
      <div class="row">
        <input type="number" class="now btn" value="0" data-target="175" data-name="Dak Prescott">
        <div class="bar"><div class="fill"></div></div>
        <div class="pct">0%</div>
      </div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Pass Yds</span><strong>Jordan Love</strong> — 200+</div>
      <div class="row">
        <input type="number" class="now btn" value="0" data-target="200" data-name="Jordan Love">
        <div class="bar"><div class="fill"></div></div>
        <div class="pct">0%</div>
      </div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Rec Yds</span><strong>Javonte Williams</strong> — 10+</div>
      <div class="row">
        <input type="number" class="now btn" value="0" data-target="10" data-name="Javonte Williams">
        <div class="bar"><div class="fill"></div></div>
        <div class="pct">0%</div>
      </div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Recs</span><strong>George Pickens</strong> — 4+</div>
      <div class="row">
        <input type="number" class="now btn" value="0" data-target="4" data-name="George Pickens">
        <div class="bar"><div class="fill"></div></div>
        <div class="pct">0%</div>
      </div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Recs</span><strong>Jake Ferguson</strong> — 5+</div>
      <div class="row">
        <input type="number" class="now btn" value="0" data-target="5" data-name="Jake Ferguson">
        <div class="bar"><div class="fill"></div></div>
        <div class="pct">0%</div>
      </div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Pass TD</span><strong>Dak Prescott</strong> — 1+</div>
      <label class="row tiny"><input type="checkbox" class="chk" data-type="td"> TD Thrown</label>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Pass TD</span><strong>Jordan Love</strong> — 1+</div>
      <label class="row tiny"><input type="checkbox" class="chk" data-type="td"> TD Thrown</label>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Pass TD</span><strong>Jordan Love</strong> — Over 1.5</div>
      <label class="row tiny"><input type="number" min="0" step="1" value="0" class="now btn" data-target="2"> TDs Now</label>
      <div class="row" style="margin-top:4px">
        <div class="bar"><div class="fill"></div></div>
        <div class="pct">0%</div>
      </div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Total</span><strong>Game Total</strong> — Under 52.5</div>
      <div class="tiny">Manually watch the score — stays green while total ≤ 52.5.</div>
    </div>
  </div>

  <h2 class="game">Baltimore Ravens @ Kansas City Chiefs</h2>
  <div class="card slip" id="slipB">
    <h3>Bet Slip B — 4-Leg Anytime TD</h3>
    <div class="bet"><div class="row"><span class="pill">ATTD</span><strong>Lamar Jackson</strong> — Anytime TD</div><label class="row tiny"><input type="checkbox" class="chk"> TD Scored</label></div>
    <div class="bet"><div class="row"><span class="pill">ATTD</span><strong>Xavier Worthy</strong> — Anytime TD</div><label class="row tiny"><input type="checkbox" class="chk"> TD Scored</label></div>
    <div class="bet"><div class="row"><span class="pill">ATTD</span><strong>Derrick Henry</strong> — Anytime TD</div><label class="row tiny"><input type="checkbox" class="chk"> TD Scored</label></div>
    <div class="bet"><div class="row"><span class="pill">ATTD</span><strong>Travis Kelce</strong> — Anytime TD</div><label class="row tiny"><input type="checkbox" class="chk"> TD Scored</label></div>
  </div>

  <div class="card slip" id="slipC">
    <h3>Bet Slip C — SGP (+993)</h3>
    <div class="bet"><div class="row"><span class="pill">FTD</span><strong>Flowers OR Henry</strong> — First TD (either)</div><label class="row tiny"><input type="checkbox" class="chk"> Hit</label></div>

    <div class="bet">
      <div class="row"><span class="pill">Rec Yds</span><strong>Zay Flowers</strong> — 50+</div>
      <div class="row"><input type="number" class="now btn" value="0" data-target="50" data-name="Zay Flowers"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Recs</span><strong>Zay Flowers</strong> — 5+</div>
      <div class="row"><input type="number" class="now btn" value="0" data-target="5" data-name="Zay Flowers Recs"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Rush</span><strong>Derrick Henry</strong> — 60+</div>
      <div class="row"><input type="number" class="now btn" value="0" data-target="60" data-name="Derrick Henry"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Rush</span><strong>Lamar Jackson</strong> — 30+</div>
      <div class="row"><input type="number" class="now btn" value="0" data-target="30" data-name="Lamar Rush"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div>
    </div>

    <div class="bet">
      <div class="row"><span class="pill">Pass</span><strong>Lamar Jackson</strong> — 175+ pass yds</div>
      <div class="row"><input type="number" class="now btn" value="0" data-target="175" data-name="Lamar Pass"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div>
    </div>
  </div>

  <div class="card slip" id="slipD">
    <h3>Bet Slip D — SGP (+751)</h3>
    <div class="bet"><div class="row"><span class="pill">Pass</span><strong>Patrick Mahomes</strong> — 200+ pass yds</div><div class="row"><input type="number" class="now btn" value="0" data-target="200" data-name="Patrick Mahomes"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div></div>
    <div class="bet"><div class="row"><span class="pill">Pass</span><strong>Lamar Jackson</strong> — 175+ pass yds</div><div class="row"><input type="number" class="now btn" value="0" data-target="175" data-name="Lamar Pass D"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div></div>
    <div class="bet"><div class="row"><span class="pill">Rec</span><strong>Zay Flowers</strong> — 30+ rec yds</div><div class="row"><input type="number" class="now btn" value="0" data-target="30" data-name="Zay 30"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div></div>
    <div class="bet"><div class="row"><span class="pill">Rec</span><strong>Travis Kelce</strong> — 20+ rec yds</div><div class="row"><input type="number" class="now btn" value="0" data-target="20" data-name="Kelce 20"><div class="bar"><div class="fill"></div></div><div class="pct">0%</div></div></div>
    <div class="bet"><div class="row"><span class="pill">Pass TD</span><strong>Patrick Mahomes</strong> — 1+ TD</div><label class="row tiny"><input type="checkbox" class="chk"> TD Thrown</label></div>
    <div class="bet"><div class="row"><span class="pill">Pass TD</span><strong>Lamar Jackson</strong> — 1+ TD</div><label class="row tiny"><input type="checkbox" class="chk"> TD Thrown</label></div>
    <div class="bet"><div class="row"><span class="pill">ATTD</span><strong>Derrick Henry</strong> — Anytime TD</div><label class="row tiny"><input type="checkbox" class="chk"> TD Scored</label></div>
    <div class="bet"><div class="row"><span class="pill">ATTD</span><strong>Xavier Worthy</strong> — Anytime TD</div><label class="row tiny"><input type="checkbox" class="chk"> TD Scored</label></div>
  </div>

  <div class="card tiny">Tip: You can still use this fully offline by typing numbers manually. API auto-refresh is optional.</div>
</div>

<script>
function updateBar(input){
  const wrap = input.closest('.bet');
  const fill = wrap.querySelector('.fill');
  const pct  = wrap.querySelector('.pct');
  const target = parseFloat(input.dataset.target||0);
  const now = parseFloat(input.value||0);
  const p = Math.max(0, Math.min(100, Math.round((now/target)*100)));
  if(fill){ fill.style.width = p+'%'; fill.style.background = (now>=target) ? 'linear-gradient(90deg,#0a8,#38bdf8)' : 'linear-gradient(90deg,#33c,#2aa)'; }
  if(pct){ pct.textContent = isFinite(p) ? p+'%' : '—'; }
}
document.querySelectorAll('input.now').forEach(inp=>{
  updateBar(inp);
  inp.addEventListener('input', ()=>updateBar(inp));
});

// Store & load game IDs to localStorage
const kcInp = document.getElementById('kcBal');
const gbInp = document.getElementById('gbDal');
kcInp.value = localStorage.getItem('KC_BAL_GAME_ID') || '';
gbInp.value = localStorage.getItem('GB_DAL_GAME_ID') || '';
document.getElementById('saveIds').onclick = () => {
  localStorage.setItem('KC_BAL_GAME_ID', kcInp.value.trim());
  localStorage.setItem('GB_DAL_GAME_ID', gbInp.value.trim());
  alert('Saved!');
};

// === Optional: MySportsFeeds auto-refresh (via /api/msf proxy) ===
// 1) Deploy to Vercel with MSF_API_KEY set in Project → Settings → Environment Variables.
// 2) Click "Load Week 4 list" to see the raw games JSON and copy your two game IDs.
// 3) Uncomment REFRESH loop after you confirm the box score feed path.

async function msf(path, q=''){
  const url = `/api/msf?path=${encodeURIComponent(path)}${q ? `&q=${encodeURIComponent(q)}` : ''}`;
  const r = await fetch(url);
  if(!r.ok) throw new Error('MSF '+r.status);
  return r.json();
}

document.getElementById('loadWeek').onclick = async () => {
  const out = document.getElementById('gamesOut');
  out.textContent = 'Loading Week 4 games...';
  try {
    const data = await msf('v2.0/pull/nfl/2025-regular/week/4/games.json');
    out.textContent = JSON.stringify(data, null, 2).slice(0, 4000) + '…';
  } catch(e){
    out.textContent = 'Could not load: '+e.message+' — Did you deploy the /api/msf proxy and set MSF_API_KEY?';
  }
};

// Placeholder: determine your box score feed path in your MSF portal, then set here:
const BOX_FEED_PATH = 'v2.0/pull/nfl/2025-regular/game_boxscore.json'; // verify in your docs!

// Helper to safely drill into objects
const getNested = (obj, pathArr)=> pathArr.reduce((o,k)=> (o && o[k]!==undefined) ? o[k] : undefined, obj);

// Map players → DOM selectors and stat keys (adjust once you see your JSON)
const playerMap = {
  "Dak Prescott":   { sel: 'input.now[data-name="Dak Prescott"]',   path: ['passing','passYards'] },
  "Jordan Love":    { sel: 'input.now[data-name="Jordan Love"]',    path: ['passing','passYards'] },
  "Zay Flowers":    { sel: 'input.now[data-name="Zay Flowers"]',    path: ['receiving','recYards'] },
  "Derrick Henry":  { sel: 'input.now[data-name="Derrick Henry"]',  path: ['rushing','rushYards'] },
  "Lamar Pass":     { sel: 'input.now[data-name="Lamar Pass"]',     path: ['passing','passYards'] },
  "Patrick Mahomes":{ sel: 'input.now[data-name="Patrick Mahomes"]',path: ['passing','passYards'] },
  "Kelce 20":       { sel: 'input.now[data-name="Kelce 20"]',       path: ['receiving','recYards'] },
  "Zay 30":         { sel: 'input.now[data-name="Zay 30"]',         path: ['receiving','recYards'] },
};

async function getGameBox(gameId){
  // Two common styles — your portal will show the exact one:
  // A) .../games/{gameId}/boxscore.json
  // B) .../game_boxscore.json?game={gameId}
  // We implement B as default:
  return msf(BOX_FEED_PATH, 'game='+encodeURIComponent(gameId));
}

async function refresh(){
  try{
    const kcId = localStorage.getItem('KC_BAL_GAME_ID');
    const gbId = localStorage.getItem('GB_DAL_GAME_ID');
    if(!kcId && !gbId) return;

    const [kc, gb] = await Promise.all([kcId?getGameBox(kcId):null, gbId?getGameBox(gbId):null]);
    const live = {};

    [kc, gb].forEach(box => {
      if(!box) return;
      // Inspect in DevTools to confirm the exact path to players; adjust if needed:
      const teams = box?.boxscore?.teams || box?.gamebox?.teams || [];
      teams.forEach(team => {
        (team.players || []).forEach(p => {
          const name = p.player?.name || [p.player?.firstName, p.player?.lastName].filter(Boolean).join(' ');
          if(!name) return;
          live[name] = p.stats || p.playerStats || {};
        });
      });
    });

    for(const [label, spec] of Object.entries(playerMap)){
      const el = document.querySelector(spec.sel);
      if(!el) continue;
      let val = 0;
      // Try exact label first, else try splitting on space to match full name
      const stats = live[label] || live[label.replace(/ \d\d$/, '')] || null;
      if(stats){
        const x = getNested(stats, spec.path);
        if(typeof x === 'number') val = x;
      }
      if(Number.isFinite(val)){
        el.value = String(val);
        el.dispatchEvent(new Event('input', {bubbles:true}));
      }
    }
  }catch(e){
    console.warn('Refresh error', e);
  }
}

// Uncomment to enable auto refresh once your proxy & feed path are confirmed:
// setInterval(refresh, 30000);
</script>
</body>
</html>