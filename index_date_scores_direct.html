
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sweat Tracker — Direct Scores (date feed)</title>
<style>
  :root{--bg:#0b1020;--card:#11162a;--ink:#f8fafc;--muted:#94a3b8;--line:#1f2a44;--good:#10b981}
  body{margin:0;background:#0b1020;color:var(--ink);font-family:Inter,system-ui,Arial}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .panel{background:#11162a;border:1px solid #1f2a44;border-radius:14px;padding:14px;margin:12px 0}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .card{background:#0f152a;border:1px solid #202b4a;border-radius:14px;padding:12px}
  .row{display:flex;align-items:center;gap:10px;justify-content:space-between}
  .badge{width:28px;height:28px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
  .label{font-size:13px;color:#cbd5e1}
  .score{font-size:22px;font-weight:800}
  .dot{width:8px;height:8px;border-radius:50%;background:#22c55e;box-shadow:0 0 12px #22c55e}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel"><strong>Mode:</strong> v2.1 <code>date/20250928/games.json</code> → <em>read score directly</em>. Auto-refresh every 20s.</div>
  <div class="panel">
    <div class="row">
      <strong>Sunday Scoreboard — Sept 28</strong>
      <div class="row" style="gap:8px"><div class="dot"></div><span class="label">Live</span></div>
    </div>
  </div>
  <div class="grid" id="grid"></div>
</div>

<script>
const TEAM = { ARI:'#97233F', ATL:'#A71930', BAL:'#241773', BUF:'#00338D', CAR:'#0085CA', CHI:'#0B162A',
 CIN:'#FB4F14', CLE:'#311D00', DAL:'#041E42', DEN:'#FB4F14', DET:'#0076B6', GB:'#203731', HOU:'#03202F',
 IND:'#002C5F', JAX:'#006778', KC:'#E31837', LAC:'#0080C6', LAR:'#003594', LV:'#000000', MIA:'#008E97',
 MIN:'#4F2683', NE:'#002244', NO:'#D3BC8D', NYG:'#0B2265', NYJ:'#125740', PHI:'#004C54', PIT:'#FFB612',
 SF:'#AA0000', SEA:'#002244', TB:'#D50A0A', TEN:'#0C2340', WAS:'#5A1414' };
const badge = a=>`<div class="badge" style="background:${TEAM[a]||'#64748b'}">${a}</div>`;
const qs=s=>document.querySelector(s);

async function msf(path){
  const r = await fetch(`/api/msf?path=${encodeURIComponent(path)}`);
  if(!r.ok) throw new Error('HTTP '+r.status);
  return r.json();
}

function card(g){
  return `<div class="card" data-id="${g.id}">
    <div class="row">
      <div class="row" style="gap:8px"><div>${badge(g.awayAb)}</div><div><div class="label">${g.awayName}</div><div class="score" data-away>${g.away}</div></div></div>
      <div class="row" style="gap:8px"><div>${badge(g.homeAb)}</div><div><div class="label">${g.homeName}</div><div class="score" data-home>${g.home}</div></div></div>
    </div>
    <div class="label" data-status>${g.status}</div>
  </div>`;
}

function parseGames(feed){
  const arr = feed?.games || feed?.game || [];
  return arr.map(it=>{
    const sch = it.schedule || {};
    const sc  = it.score || {};
    const id  = sch.id;
    const awayAb = sch.awayTeam?.abbreviation;
    const homeAb = sch.homeTeam?.abbreviation;
    const awayName = awayAb;
    const homeName = homeAb;
    const status = sch.playedStatus ? sch.playedStatus.replaceAll('_',' ') : 'Scheduled';
    return { id, awayAb, homeAb, awayName, homeName, away: sc.awayScoreTotal||0, home: sc.homeScoreTotal||0, status };
  });
}

async function render(){
  const feed = await msf('v2.1/pull/nfl/2025-regular/date/20250928/games.json');
  const list = parseGames(feed);
  if(!qs('#grid').children.length){
    qs('#grid').innerHTML = list.map(card).join('');
  }else{
    list.forEach(g=>{
      const el = document.querySelector(\`.card[data-id="\${g.id}"]\`);
      if(!el) return;
      el.querySelector('[data-away]').textContent = g.away;
      el.querySelector('[data-home]').textContent = g.home;
      el.querySelector('[data-status]').textContent = g.status;
    });
  }
}

render();
setInterval(render, 20000);
</script>
</body>
</html>
